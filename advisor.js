// advisor.js ‚Äî –£–º–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫ –¥–ª—è KIVI Business

(async () => {
  const dataUrl = SHEETS.data;
  const ebitdaUrl = SHEETS.ebitda;
  const leadersUrl = SHEETS.leaders;

  const parse = async (url) => {
    const res = await fetch(url);
    const text = await res.text();
    return Papa.parse(text, { header: true }).data;
  };

  const clean = v => parseFloat((v || '0').toString().replace(/\s/g, '').replace(',', '.'));

  const data = await parse(dataUrl);
  const costs = await parse(ebitdaUrl);
  const leaders = await parse(leadersUrl);

  const today = new Date();
  const ym = today.toISOString().slice(0, 7);
  const currentDay = today.getDate();
  const dayOfWeek = today.getDay();
  const currentYear = today.getFullYear();
  const lastYear = currentYear - 1;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–≥–æ–¥–Ω—è
  const cashierToday = [2, 3, 4].includes(dayOfWeek) ? '–î–º–∏—Ç—Ä–∏–π' : '–î–µ–Ω–∏—Å';
  const dayNames = ['–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞', '—Å—É–±–±–æ—Ç–∞'];
  const todayName = dayNames[dayOfWeek];

  // –î–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
  const thisMonthData = data.filter(r => {
    const d = new Date(r["–î–∞—Ç–∞"]);
    return r["–î–∞—Ç–∞"]?.startsWith(ym) && d <= today && clean(r["–¢–û"]) > 0;
  });

  // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—à–ª–æ–≥–æ –≥–æ–¥–∞ (—Ç–æ—Ç –∂–µ –º–µ—Å—è—Ü, –≤—Å–µ –¥–Ω–∏)
  const lastYearMonth = data.filter(r => {
    const d = new Date(r["–î–∞—Ç–∞"]);
    return d.getFullYear() === lastYear && d.getMonth() === today.getMonth() && clean(r["–¢–û"]) > 0;
  });

  // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
  const last7Days = thisMonthData.slice(-7);

  // –ö–∞—Ä—Ç–∞ –º–µ—Å—è—Ü–∞ –ø—Ä–æ—à–ª–æ–≥–æ –≥–æ–¥–∞ (–¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞)
  const lastYearHeatmap = {};
  lastYearMonth.forEach(r => {
    const d = new Date(r["–î–∞—Ç–∞"]);
    const day = d.getDate();
    if (!lastYearHeatmap[day]) lastYearHeatmap[day] = 0;
    lastYearHeatmap[day] += clean(r["–¢–û"]);
  });

  // –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ 3 –¥–Ω—è (–ø–æ –ø—Ä–æ—à–ª–æ–º—É –≥–æ–¥—É)
  const next3DaysForecast = [];
  for (let i = 1; i <= 3; i++) {
    const nextDay = currentDay + i;
    const lastYearRevenue = lastYearHeatmap[nextDay] || 0;
    if (lastYearRevenue > 0) {
      next3DaysForecast.push({ day: nextDay, revenue: Math.round(lastYearRevenue) });
    }
  }

  // –†–∞—Å—á—ë—Ç—ã
  const totalRevenue = thisMonthData.reduce((s, r) => s + clean(r["–¢–û"]), 0);
  const totalTraffic = thisMonthData.reduce((s, r) => s + clean(r["–¢–†"]), 0);
  const avgRevenue = totalRevenue / thisMonthData.length;
  const avgTraffic = totalTraffic / thisMonthData.length;
  const avgCheck = totalTraffic ? Math.round(totalRevenue / totalTraffic) : 0; // –†–ï–ê–õ–¨–ù–´–ô —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
  const avgASP = thisMonthData.reduce((s, r) => s + clean(r["—Ä–∞—Å—á–µ—Ç ASP"]), 0) / thisMonthData.length;
  const asp = avgASP ? Math.round(avgRevenue / avgASP) : 0; // –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞

  // EBITDA
  let totalCosts = 0;
  let costBreakdown = [];
  costs.forEach(row => {
    const value = clean(row["–ó–Ω–∞—á–µ–Ω–∏–µ"]);
    const type = (row["–¢–∏–ø"] || '').toLowerCase();
    let cost = 0;
    if (type.includes("—Ä—É–±")) cost = value;
    else if (type.includes("%")) cost = avgRevenue * value / 100;
    if (cost > 0) {
      totalCosts += cost;
      costBreakdown.push({ name: row["–°—Ç–∞—Ç—å—è"], value: cost, isPercent: type.includes("%") });
    }
  });
  const ebitda = avgRevenue - totalCosts;
  const ebitdaPercent = avgRevenue ? Math.round((ebitda / avgRevenue) * 100) : 0;

  // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º –≥–æ–¥–æ–º
  const lastYearTotal = lastYearMonth.reduce((s, r) => s + clean(r["–¢–û"]), 0);
  const lastYearAvg = lastYearMonth.length > 0 ? lastYearTotal / lastYearMonth.length : 0;
  const growthPercent = lastYearAvg ? Math.round(((avgRevenue - lastYearAvg) / lastYearAvg) * 100) : 0;

  // –¢—Ä–µ–Ω–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
  const trend7Days = last7Days.length >= 2 ? clean(last7Days[last7Days.length - 1]["–¢–û"]) - clean(last7Days[0]["–¢–û"]) : 0;

  // –õ–∏–¥–µ—Ä—ã –ø—Ä–æ–¥–∞–∂ (VC vs AN)
  const leadersList = leaders.filter(r => r["–õ–∏–¥–µ—Ä—ã –ø—Ä–æ–¥–∞–∂"]).map(r => r["–õ–∏–¥–µ—Ä—ã –ø—Ä–æ–¥–∞–∂"]);
  const vcLeaders = leadersList.filter(l => l.startsWith('VC')).slice(0, 3);
  const anLeaders = leadersList.filter(l => l.startsWith('AN')).slice(0, 3);
  const top5Overall = leadersList.slice(0, 5);

  // üß† –£–ú–ù–´–ô –ê–ù–ê–õ–ò–ó
  const insights = [];
  const warnings = [];
  const actions = [];

  // === –ü–†–ò–í–ï–¢–°–¢–í–ò–ï –° –ö–ê–°–°–ò–†–û–ú ===
  insights.push(`üëã –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, **${cashierToday}**! –°–µ–≥–æ–¥–Ω—è ${todayName}. –í–æ—Ç —á—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –ø–µ—Ä–µ–¥ —Å–º–µ–Ω–æ–π:`);

  // === –ê–ù–ê–õ–ò–ó –†–ï–ù–¢–ê–ë–ï–õ–¨–ù–û–°–¢–ò ===
  if (ebitdaPercent < 0) {
    warnings.push('üö® –ö—Ä–∏—Ç–∏—á–Ω–æ: —Ä–∞–±–æ—Ç–∞–µ–º –≤ —É–±—ã—Ç–æ–∫');
    insights.push(`**–í–∏–∫—Ç–æ—Ä –∏ –ö–∏—Ä–∏–ª–ª:** EBITDA ${ebitdaPercent}% ‚Äî —Å—Ä–æ—á–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ü–µ–Ω—ã –∏–ª–∏ —Å–Ω–∏–∑–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã. –¢–æ–ø-3 —Ä–∞—Å—Ö–æ–¥–∞: ${costBreakdown.sort((a, b) => b.value - a.value).slice(0, 3).map(c => `${c.name} (${Math.round(c.value)}‚ÇΩ)`).join(', ')}`);
  } else if (ebitdaPercent < 15) {
    warnings.push('‚ö†Ô∏è –ù–∏–∑–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å');
    insights.push(`**–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º:** EBITDA ${ebitdaPercent}% ‚Äî –Ω–∏–∂–µ —Ü–µ–ª–µ–≤—ã—Ö 20%. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: 1) –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Å–ª–æ–≤–∏—è —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏, 2) –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω, 3) –ø–æ–≤—ã—Å–∏—Ç—å —Ü–µ–Ω—ã –Ω–∞ 3-5%`);
  }

  // === –°–†–ï–î–ù–ò–ô –ß–ï–ö –ò ASP ===
  if (avgCheck < 600) {
    warnings.push(`üìâ –ù–∏–∑–∫–∏–π —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ (${avgCheck}‚ÇΩ)`);
    actions.push(`**${cashierToday}:** –ê–∫—Ç–∏–≤–Ω–æ –¥–æ–ø—Ä–æ–¥–∞–≤–∞–π!`);
    insights.push(`**${cashierToday}**, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ ${avgCheck}‚ÇΩ ‚Äî –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª! 
    
**–¢–µ—Ö–Ω–∏–∫–∏ –¥–æ–ø—Ä–æ–¥–∞–∂ –¥–ª—è —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π –æ–¥–µ–∂–¥—ã:**
1. **–ö–æ–º–±–æ-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:** "–ö —ç—Ç–æ–π —Ñ—É—Ç–±–æ–ª–∫–µ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥–æ–π–¥—É—Ç –Ω–æ—Å–∫–∏ ‚Äî –≤–æ–∑—å–º—ë–º 2-3 –ø–∞—Ä—ã? –°–µ–π—á–∞—Å –∞–∫—Ü–∏—è 3 –ø–æ —Ü–µ–Ω–µ 2!"
2. **–°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å:** "–•—É–¥–∏ —Å–µ–π—á–∞—Å –æ—á–µ–Ω—å –∞–∫—Ç—É–∞–ª—å–Ω–æ ‚Äî –Ω–∞ —É–ª–∏—Ü–µ —Ö–æ–ª–æ–¥–∞–µ—Ç. –ú–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–∏—Ç—à–æ—Ç –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è?"
3. **–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å:** "–¢—Ä—É—Å—ã –ª—É—á—à–µ –±—Ä–∞—Ç—å —Å—Ä–∞–∑—É –∫–æ–º–ø–ª–µ–∫—Ç–æ–º ‚Äî —Ç–∞–∫ —ç–∫–æ–Ω–æ–º–Ω–µ–µ. –£ –Ω–∞—Å –µ—Å—Ç—å –Ω–∞–±–æ—Ä –∏–∑ 5 —à—Ç—É–∫"
4. **–ö–∞—á–µ—Å—Ç–≤–æ:** "–≠—Ç–æ –æ—á–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–µ—â—å, –ø—Ä–æ—Å–ª—É–∂–∏—Ç –¥–æ–ª–≥–æ. –ë–µ—Ä–∏—Ç–µ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫ –∏–ª–∏ –ø—Ä–æ –∑–∞–ø–∞—Å"
5. **–ò–º–ø—É–ª—å—Å —É –∫–∞—Å—Å—ã:** –†–∞–∑–ª–æ–∂–∏ –Ω–æ—Å–∫–∏ –∏ —Ç—Ä—É—Å—ã –Ω–∞ –≤–∏–¥–Ω–æ–º –º–µ—Å—Ç–µ —É –∫–∞—Å—Å—ã ‚Äî —ç—Ç–æ –∏–º–ø—É–ª—å—Å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è

**–¶–µ–ª—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:** —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ **700‚ÇΩ+** (—Å–µ–π—á–∞—Å ${avgCheck}‚ÇΩ)`);
  } else if (avgCheck > 800) {
    insights.push(`üíé **${cashierToday}**, –æ—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ ${avgCheck}‚ÇΩ ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!`);
  }

  if (asp < 250) {
    insights.push(`**–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º:** –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞ ${asp}‚ÇΩ ‚Äî –Ω–∏–∑–∫–∞—è. –í–æ–∑–º–æ–∂–Ω–æ, —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –Ω–µ–¥–æ—Ä–æ–≥–∏—Ö –ø–æ–∑–∏—Ü–∏–π (–Ω–æ—Å–∫–∏, —Ç—Ä—É—Å—ã). –î–æ–±–∞–≤—å—Ç–µ –≤ –≤—ã–∫–ª–∞–¥–∫—É –±–æ–ª—å—à–µ —Ö—É–¥–∏ –∏ —Å–≤–∏—Ç—à–æ—Ç–æ–≤ (–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)`);
  }

  // === –¢–†–ê–§–ò–ö ===
  if (avgTraffic < 25) {
    warnings.push(`üë• –ù–∏–∑–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫ (${Math.round(avgTraffic)} —á–µ–ª/–¥–µ–Ω—å)`);
    insights.push(`**–í–∏–∫—Ç–æ—Ä –∏ –ö–∏—Ä–∏–ª–ª:** –¢—Ä–∞—Ñ–∏–∫ ${Math.round(avgTraffic)} —á–µ–ª–æ–≤–µ–∫ ‚Äî –º–∞–ª–æ –¥–ª—è –†–µ—É—Ç–æ–≤–∞. 
    
**–î–µ–π—Å—Ç–≤–∏—è:**
1. **–¢–∞—Ä–≥–µ—Ç –í–ö–æ–Ω—Ç–∞–∫—Ç–µ/Instagram** –Ω–∞ –†–µ—É—Ç–æ–≤ (—Ä–∞–¥–∏—É—Å 3–∫–º) ‚Äî "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –æ–¥–µ–∂–¥–∞ –æ—Ç 199‚ÇΩ"
2. **–ü—Ä–æ–º–æ —É –≤—Ö–æ–¥–∞:** –®—Ç–µ–Ω–¥–µ—Ä "–ê–ö–¶–ò–Ø: –Ω–æ—Å–∫–∏ 3 –ø–æ —Ü–µ–Ω–µ 2" –∏–ª–∏ "–•—É–¥–∏ –æ—Ç 999‚ÇΩ"
3. **–ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞:** –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è —Å —Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±–∞–º–∏ –†–µ—É—Ç–æ–≤–∞ –æ –≤–∑–∞–∏–º–Ω–æ–π —Ä–µ–∫–ª–∞–º–µ
4. **–õ–∏—Å—Ç–æ–≤–∫–∏:** —Ä–∞–∑–¥–∞—á–∞ –≤–æ–∑–ª–µ –¢–¶/–º–µ—Ç—Ä–æ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º –Ω–∞ —Å–∫–∏–¥–∫—É
5. **–í—ã–≤–µ—Å–∫–∞:** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å`);
  } else if (avgTraffic > 35) {
    insights.push(`üöÄ –û—Ç–ª–∏—á–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ ${Math.round(avgTraffic)} —á–µ–ª/–¥–µ–Ω—å! –¢–µ–ø–µ—Ä—å —Ñ–æ–∫—É—Å –Ω–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞`);
  }

  // === –°–†–ê–í–ù–ï–ù–ò–ï –° –ü–†–û–®–õ–´–ú –ì–û–î–û–ú ===
  if (growthPercent < -5) {
    warnings.push(`üìä –ü–∞–¥–µ–Ω–∏–µ –Ω–∞ ${Math.abs(growthPercent)}% –∫ –ø—Ä–æ—à–ª–æ–º—É –≥–æ–¥—É`);
    insights.push(`–í—ã—Ä—É—á–∫–∞ —É–ø–∞–ª–∞ –Ω–∞ ${Math.abs(growthPercent)}% vs ${lastYear} –≥–æ–¥. **–ü—Ä–∏—á–∏–Ω—ã?** 
1) –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–Ω—ã –≤ —Å–æ—Å–µ–¥–Ω–∏—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö)
2) –ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç (–º–æ–∂–µ—Ç, –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–æ–≤–∏–Ω–æ–∫?)
3) –°–µ—Ä–≤–∏—Å (–æ–ø—Ä–æ—Å–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤: "–ß—Ç–æ —É–ª—É—á—à–∏—Ç—å?")
4) –†–µ—É—Ç–æ–≤: –≤–æ–∑–º–æ–∂–Ω–æ, –æ—Ç–∫—Ä—ã–ª–∏—Å—å –Ω–æ–≤—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã –æ–¥–µ–∂–¥—ã?`);
  } else if (growthPercent > 10) {
    insights.push(`üéâ –†–æ—Å—Ç –Ω–∞ ${growthPercent}% –∫ –ø—Ä–æ—à–ª–æ–º—É –≥–æ–¥—É ‚Äî –æ—Ç–ª–∏—á–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞! –ó–∞–∫—Ä–µ–ø–ª—è–π—Ç–µ —É—Å–ø–µ—Ö`);
  }

  // === –¢–†–ï–ù–î 7 –î–ù–ï–ô ===
  if (trend7Days < -2000) {
    warnings.push('üìâ –ü–∞–¥–µ–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π');
    insights.push(`**–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º:** –í—ã—Ä—É—á–∫–∞ –ø–∞–¥–∞–µ—Ç –Ω–µ–¥–µ–ª—é –ø–æ–¥—Ä—è–¥ (${Math.round(trend7Days)}‚ÇΩ). –°—Ä–æ—á–Ω–æ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–∫—Ü–∏—é "–°—á–∞—Å—Ç–ª–∏–≤—ã–µ —á–∞—Å—ã" (—Å–∫–∏–¥–∫–∞ 10% —Å 17:00 –¥–æ 19:00)`);
  } else if (trend7Days > 2000) {
    insights.push(`üìà –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–¥! –í—ã—Ä—É—á–∫–∞ —Ä–∞—Å—Ç—ë—Ç (+${Math.round(trend7Days)}‚ÇΩ –∑–∞ –Ω–µ–¥–µ–ª—é) üí™`);
  }

  // === –ü–†–û–ì–ù–û–ó –ù–ê –ë–õ–ò–ñ–ê–ô–®–ò–ï –î–ù–ò (–ü–û –ö–ê–†–¢–ï –ú–ï–°–Ø–¶–ê) ===
  if (next3DaysForecast.length > 0) {
    const forecastText = next3DaysForecast.map(f => `${f.day} —á–∏—Å–ª–æ ‚Üí ~${f.revenue.toLocaleString('ru-RU')}‚ÇΩ`).join(', ');
    insights.push(`üìÖ **–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ –∫–∞—Ä—Ç–µ –º–µ—Å—è—Ü–∞** (–Ω–∞ –æ—Å–Ω–æ–≤–µ ${lastYear} –≥–æ–¥–∞): ${forecastText}. 
    
${next3DaysForecast.some(f => f.revenue > avgRevenue * 1.3) ? 
  `‚ö° **–í–°–ü–õ–ï–°–ö!** ${next3DaysForecast.filter(f => f.revenue > avgRevenue * 1.3).map(f => `${f.day} —á–∏—Å–ª–æ`).join(', ')} ‚Äî –≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –≤—ã—Å–æ–∫–æ–º—É —Ç—Ä–∞—Ñ–∏–∫—É! **${cashierToday}**, –±—É–¥—å –Ω–∞ –ø–∏–∫–µ, —Ä–∞–±–æ—Ç–∞–π –±—ã—Å—Ç—Ä–æ, –ø—Ä–µ–¥–ª–∞–≥–∞–π –∞–∫—Ç–∏–≤–Ω–æ` : 
  `–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–Ω–∏ ‚Äî —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–ª–∞–Ω–æ–≤–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ –¥–æ–ø—Ä–æ–¥–∞–∂`}`);
  }

  // === –õ–ò–î–ï–†–´ –ü–†–û–î–ê–ñ (VC vs AN) ===
  if (vcLeaders.length > 0 || anLeaders.length > 0) {
    insights.push(`üèÜ **–õ–∏–¥–µ—Ä—ã –ø—Ä–æ–¥–∞–∂ —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞:**`);
    
    if (vcLeaders.length > anLeaders.length) {
      insights.push(`**–¢–æ–≤–∞—Ä—ã –í–∏–∫—Ç–æ—Ä–∞ (VC)** –ª–∏–¥–∏—Ä—É—é—Ç: ${vcLeaders.join(', ')}. 
      
**–í–∏–∫—Ç–æ—Ä:** –£–≤–µ–ª–∏—á—å –∑–∞–∫—É–ø–∫—É —ç—Ç–∏—Ö –ø–æ–∑–∏—Ü–∏–π –Ω–∞ 30-40%, —Ä–∞–∑–º–µ—Å—Ç–∏ –Ω–∞ —Å–∞–º—ã—Ö –≤–∏–¥–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö (–Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–ª–∞–∑).
**–ö–∏—Ä–∏–ª–ª:** –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π, –ø–æ—á–µ–º—É —Ç–≤–æ–∏ —Ç–æ–≤–∞—Ä—ã (AN) –æ—Ç—Å—Ç–∞—é—Ç. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ: 1) –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ü–µ–Ω—ã, 2) —É–ª—É—á—à–∏—Ç—å –≤—ã–∫–ª–∞–¥–∫—É, 3) –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏`);
    } else if (anLeaders.length > vcLeaders.length) {
      insights.push(`**–¢–æ–≤–∞—Ä—ã –ö–∏—Ä–∏–ª–ª–∞ (AN)** –ª–∏–¥–∏—Ä—É—é—Ç: ${anLeaders.join(', ')}.
      
**–ö–∏—Ä–∏–ª–ª:** –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –£–≤–µ–ª–∏—á—å –∑–∞–ø–∞—Å –Ω–∞ 30-40%, —Ä–∞–∑–º–µ—Å—Ç–∏ –Ω–∞ –≤—Ö–æ–¥–µ.
**–í–∏–∫—Ç–æ—Ä:** –¢–≤–æ–∏ —Ç–æ–≤–∞—Ä—ã (VC) –ø—Ä–æ–¥–∞—é—Ç—Å—è —Å–ª–∞–±–µ–µ ‚Äî –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∏–ª–∏ —Ü–µ–Ω—ã`);
    } else {
      insights.push(`VC –∏ AN –ø—Ä–æ–¥–∞—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ. –¢–æ–ø-5: ${top5Overall.join(', ')}`);
    }
    
    actions.push(`**${cashierToday}:** –ü—Ä–µ–¥–ª–∞–≥–∞–π –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å: ${top5Overall.slice(0, 3).join(', ')}`);
  }

  // === –î–ï–ù–¨ –ù–ï–î–ï–õ–ò ===
  if ([6, 0].includes(dayOfWeek)) { // –í—ã—Ö–æ–¥–Ω—ã–µ
    insights.push(`üéâ **${todayName.toUpperCase()}** ‚Äî –ø–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞! **–î–µ–Ω–∏—Å**, —Å–µ–≥–æ–¥–Ω—è –±—É–¥–µ—Ç –∂–∞—Ä–∫–æ:
1. –†–∞–±–æ—Ç–∞–π –±—ã—Å—Ç—Ä–æ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ
2. –£–ª—ã–±–∞–π—Å—è ‚Äî –∫–ª–∏–µ–Ω—Ç—ã —ç—Ç–æ —Ü–µ–Ω—è—Ç
3. –ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–º–ø–ª–µ–∫—Ç—ã: "–§—É—Ç–±–æ–ª–∫–∞ + –Ω–æ—Å–∫–∏ + —Ç—Ä—É—Å—ã = –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä!"
4. –ü–æ–¥–≥–æ—Ç–æ–≤—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø–∞—Å –Ω–æ—Å–∫–æ–≤ –∏ —Ç—Ä—É—Å–æ–≤ (—Å–∞–º—ã–µ —Ö–æ–¥–æ–≤—ã–µ)
5. –¶–µ–ª—å: —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ **750‚ÇΩ+**, —Ç—Ä–∞—Ñ–∏–∫ **40+ —á–µ–ª–æ–≤–µ–∫**`);
  } else if (dayOfWeek === 5) { // –ü—è—Ç–Ω–∏—Ü–∞
    insights.push(`üéä **–ü—è—Ç–Ω–∏—Ü–∞** ‚Äî –ø—Ä–µ–¥–≤—ã—Ö–æ–¥–Ω–æ–π –≤—Å–ø–ª–µ—Å–∫! **–î–µ–Ω–∏—Å**, –≥–æ—Ç–æ–≤—å—Å—è:
1. –õ—é–¥–∏ –ø–æ–∫—É–ø–∞—é—Ç –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–Ω—ã–º–∏ ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–π "–Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é"
2. –ü—Ä–æ–º–æ: "–ë–µ—Ä–∏—Ç–µ —Ö—É–¥–∏ —Å–µ–π—á–∞—Å ‚Äî –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è!"
3. –ü–æ–¥–≥–æ—Ç–æ–≤—å –≤–∏—Ç—Ä–∏–Ω—É —Å –Ω–æ–≤–∏–Ω–∫–∞–º–∏`);
  } else if (dayOfWeek === 1) { // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
    insights.push(`‚òï **–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫** ‚Äî –º–µ–¥–ª–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç –Ω–µ–¥–µ–ª–∏. **–î–µ–Ω–∏—Å**:
1. –¢—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –Ω–∏–∂–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –≤—Ä–µ–º—è –¥–ª—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
2. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∫–æ–ª–µ–±–ª–µ—Ç—Å—è ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ —Å–∫–∏–¥–∫—É 5% "–≤ —á–µ—Å—Ç—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏"
3. –û–±–Ω–æ–≤–∏ –≤—ã–∫–ª–∞–¥–∫—É ‚Äî –≥–æ—Ç–æ–≤—å—Å—è –∫ —Å–µ—Ä–µ–¥–∏–Ω–µ –Ω–µ–¥–µ–ª–∏`);
  } else { // –í—Ç–æ—Ä–Ω–∏–∫-—á–µ—Ç–≤–µ—Ä–≥
    insights.push(`üíº **${todayName}** ‚Äî —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å. **–î–º–∏—Ç—Ä–∏–π**:
1. –°—Ä–µ–¥–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫ ‚Äî —Ñ–æ–∫—É—Å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
2. –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –¥–∏–∞–ª–æ–≥ —Å –∫–ª–∏–µ–Ω—Ç–æ–º ‚Äî —É–∑–Ω–∞–≤–∞–π –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
3. –ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–º–ø–ª–µ–∫—Ç—ã: "–î–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ª—É—á—à–µ –≤–∑—è—Ç—å 3-4 –∫–æ–º–ø–ª–µ–∫—Ç–∞ —Å—Ä–∞–∑—É"`);
  }

  // === –ó–ê–ö–£–ü–ö–ê ===
  const last3Days = thisMonthData.slice(-3);
  const avg3 = last3Days.reduce((sum, r) => sum + clean(r["–¢–û"]), 0) / (last3Days.length || 1);
  const recommendedPurchase = Math.round(avg3 * 4 * 0.45);
  
  insights.push(`üí∞ **–í–∏–∫—Ç–æ—Ä –∏ –ö–∏—Ä–∏–ª–ª:** –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –∑–∞–∫—É–ø–∫–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é: **${recommendedPurchase.toLocaleString('ru-RU')}‚ÇΩ** (45% –æ—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞ 4-–¥–Ω–µ–≤–Ω–æ–π –≤—ã—Ä—É—á–∫–∏). 

**–ß—Ç–æ –∑–∞–∫—É–ø–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ:**
1. **–õ–∏–¥–µ—Ä—ã:** ${top5Overall.slice(0, 3).join(', ')} ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–ø–∞—Å
2. **–•–æ–¥–æ–≤–∏–∫–∏:** –ù–æ—Å–∫–∏ (3-5 –ø–∞—Ä –≤ —á–µ–∫–µ), —Ç—Ä—É—Å—ã (–∫–æ–º–ø–ª–µ–∫—Ç—ã –ø–æ 5 —à—Ç)
3. **–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ–µ:** –•—É–¥–∏ –∏ —Å–≤–∏—Ç—à–æ—Ç—ã (–≤—ã—Å–æ–∫–∞—è –Ω–∞—Ü–µ–Ω–∫–∞)
4. **–°–µ–∑–æ–Ω:** –°–µ–π—á–∞—Å –¥–µ–∫–∞–±—Ä—å ‚Äî —Ç—ë–ø–ª–∞—è –æ–¥–µ–∂–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞

**–ù–µ –ø—Ä–µ–≤—ã—à–∞–π—Ç–µ ${(recommendedPurchase + 5000).toLocaleString('ru-RU')}‚ÇΩ**, —á—Ç–æ–±—ã –Ω–µ –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å –¥–µ–Ω—å–≥–∏ –≤ —Ç–æ–≤–∞—Ä–µ`);

  // === –ö–ê–ß–ï–°–¢–í–û –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø ===
  if (avgTraffic > 25 && avgCheck < 650) {
    insights.push(`üéì **${cashierToday}**, —Ç—Ä–∞—Ñ–∏–∫ —Ö–æ—Ä–æ—à–∏–π (${Math.round(avgTraffic)} —á–µ–ª), –Ω–æ —á–µ–∫ –Ω–∏–∑–∫–∏–π (${avgCheck}‚ÇΩ). 

**–°–∫—Ä–∏–ø—Ç –¥–æ–ø—Ä–æ–¥–∞–∂:**
1. –ö–ª–∏–µ–Ω—Ç –±–µ—Ä—ë—Ç —Ñ—É—Ç–±–æ–ª–∫—É ‚Üí "–û—Ç–ª–∏—á–Ω–æ! –ê –Ω–æ—Å–∫–∏ –Ω—É–∂–Ω—ã? –£ –Ω–∞—Å –Ω–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è, –æ—á–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ"
2. –ö–ª–∏–µ–Ω—Ç –±–µ—Ä—ë—Ç –æ–¥–Ω—É –≤–µ—â—å ‚Üí "–•–æ—Ç–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–æ–º–ø–ª–µ–∫—Ç —Å–æ —Å–∫–∏–¥–∫–æ–π? –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ 2-—Ö –≤–µ—â–µ–π ‚Äî 5% —Å–∫–∏–¥–∫–∞"
3. –ö–ª–∏–µ–Ω—Ç —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è ‚Üí "–≠—Ç–æ –Ω–∞—à —Ö–∏—Ç –ø—Ä–æ–¥–∞–∂! [–ø–æ–∫–∞–∑–∞—Ç—å –ª–∏–¥–µ—Ä–∞] –ë–µ—Ä—É—Ç –æ—á–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ, –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–ª–∏—á–Ω–æ–µ"
4. –£ –∫–∞—Å—Å—ã ‚Üí "–ù–µ –Ω—É–∂–Ω—ã –Ω–æ—Å–∫–∏? –°–µ–π—á–∞—Å –∞–∫—Ü–∏—è ‚Äî 3 –ø–æ —Ü–µ–Ω–µ 2"`);
  }

  // === –°–ü–ï–¶–ò–§–ò–ö–ê –†–ï–£–¢–û–í–ê ===
  if (avgRevenue < 18000) {
    insights.push(`**–í–∏–∫—Ç–æ—Ä –∏ –ö–∏—Ä–∏–ª–ª:** –†–µ—É—Ç–æ–≤ ‚Äî —Å–ø–∞–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω, —Å—Ä–µ–¥–Ω–∏–π –¥–æ—Å—Ç–∞—Ç–æ–∫. –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞: "**–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π —Ü–µ–Ω–µ**".

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. **–¶–µ–Ω–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞:** –Ω–æ—Å–∫–∏ 199-299‚ÇΩ, —Ñ—É—Ç–±–æ–ª–∫–∏ 399-599‚ÇΩ, —Ö—É–¥–∏ 999-1499‚ÇΩ
2. **–ê–∫—Ü–∏–∏:** "3 –ø–æ —Ü–µ–Ω–µ 2", "–ö–æ–º–ø–ª–µ–∫—Ç –¥–µ—à–µ–≤–ª–µ" ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ç–ª–∏—á–Ω–æ
3. **–†–µ–∫–ª–∞–º–∞:** –¢–∞—Ä–≥–µ—Ç –Ω–∞ —Å–µ–º—å–∏ —Å –¥–µ—Ç—å–º–∏, —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤-–ª—é–±–∏—Ç–µ–ª–µ–π
4. **–ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç:** –ë–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ (—á—ë—Ä–Ω—ã–π, —Å–µ—Ä—ã–π, –±–µ–ª—ã–π) + —è—Ä–∫–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã
5. **–ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞:** –î–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è —Å –º–µ—Å—Ç–Ω—ã–º–∏ —à–∫–æ–ª–∞–º–∏/—Å–∞–¥–∞–º–∏ –æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö (—Ñ–æ—Ä–º–∞ –¥–ª—è —Ñ–∏–∑–∫—É–ª—å—Ç—É—Ä—ã)`);
  }

  // === –ú–û–¢–ò–í–ê–¶–ò–Ø ===
  insights.push(`üéØ **${cashierToday}**, —Ü–µ–ª–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:
- **–í—ã—Ä—É—á–∫–∞:** ${Math.round(avgRevenue * 1.1).toLocaleString('ru-RU')}‚ÇΩ (+10% –∫ —Å—Ä–µ–¥–Ω–µ–º—É)
- **–°—Ä–µ–¥–Ω–∏–π —á–µ–∫:** 700‚ÇΩ+
- **–¢—Ä–∞—Ñ–∏–∫:** –æ–±—Å–ª—É–∂–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- **–î–æ–ø—Ä–æ–¥–∞–∂–∏:** –∫–∞–∂–¥–æ–º—É –≤—Ç–æ—Ä–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä

**–£–¥–∞—á–Ω–æ–π —Å–º–µ–Ω—ã! üí™**`);

  // üé® –°–û–ó–î–ê–ù–ò–ï –ë–õ–û–ö–ê
  const container = document.createElement("div");
  container.style.cssText = `
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    border-radius: 20px;
    padding: 24px;
    margin-top: 24px;
    width: 100%;
    max-width: 640px;
    box-sizing: border-box;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  `;

  let html = `
    <div style='font-size:clamp(20px, 5vw, 24px);font-weight:900;margin-bottom:8px;text-align:center;'>
      üß† –°–æ–≤–µ—Ç–Ω–∏–∫ –¥–Ω—è
    </div>
    <div style='font-size:clamp(11px, 2.8vw, 13px);opacity:0.8;text-align:center;margin-bottom:20px;'>
      ${todayName}, ${currentDay} –¥–µ–∫–∞–±—Ä—è ‚Ä¢ –°–º–µ–Ω–∞: ${cashierToday}
    </div>
  `;

  // –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  html += `
    <div style='display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;'>
      <div style='background:rgba(255,255,255,0.1);border-radius:12px;padding:12px;text-align:center;'>
        <div style='font-size:clamp(10px,2.5vw,12px);opacity:0.7;margin-bottom:4px;'>–°—Ç–æ–∏–º. —Ç–æ–≤–∞—Ä–∞</div>
        <div style='font-size:clamp(18px,4.5vw,22px);font-weight:900;'>${asp}‚ÇΩ</div>
      </div>
      <div style='background:rgba(255,255,255,0.1);border-radius:12px;padding:12px;text-align:center;'>
        <div style='font-size:clamp(10px,2.5vw,12px);opacity:0.7;margin-bottom:4px;'>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
        <div style='font-size:clamp(18px,4.5vw,22px);font-weight:900;'>${avgCheck}‚ÇΩ</div>
      </div>
      <div style='background:rgba(255,255,255,0.1);border-radius:12px;padding:12px;text-align:center;'>
        <div style='font-size:clamp(10px,2.5vw,12px);opacity:0.7;margin-bottom:4px;'>EBITDA</div>
        <div style='font-size:clamp(18px,4.5vw,22px);font-weight:900;color:${ebitdaPercent < 0 ? '#e74c3c' : ebitdaPercent < 10 ? '#f39c12' : '#2ecc71'};'>${ebitdaPercent}%</div>
      </div>
    </div>
  `;

  // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  if (warnings.length > 0) {
    html += `
      <div style='background:rgba(231,76,60,0.2);border-left:4px solid #e74c3c;border-radius:8px;padding:14px;margin-bottom:16px;'>
        <div style='font-size:clamp(13px,3.2vw,15px);font-weight:700;margin-bottom:8px;'>‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è:</div>
        ${warnings.map(w => `<div style='font-size:clamp(12px,3vw,14px);margin-bottom:6px;line-height:1.4;'>‚Ä¢ ${w}</div>`).join('')}
      </div>
    `;
  }

  // –î–µ–π—Å—Ç–≤–∏—è
  if (actions.length > 0) {
    html += `
      <div style='background:rgba(52,152,219,0.2);border-left:4px solid #3498db;border-radius:8px;padding:14px;margin-bottom:16px;'>
        <div style='font-size:clamp(13px,3.2vw,15px);font-weight:700;margin-bottom:8px;'>üéØ –î–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:</div>
        ${actions.map(a => `<div style='font-size:clamp(12px,3vw,14px);margin-bottom:6px;line-height:1.4;'>‚Ä¢ ${a}</div>`).join('')}
      </div>
    `;
  }

  // –ò–Ω—Å–∞–π—Ç—ã (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **–∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞**)
  html += `
    <div style='background:rgba(255,255,255,0.05);border-radius:12px;padding:16px;max-height:500px;overflow-y:auto;'>
      <div style='font-size:clamp(14px,3.5vw,16px);font-weight:700;margin-bottom:12px;'>üí° –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</div>
      ${insights.map((ins, i) => {
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º **—Ç–µ–∫—Å—Ç** –≤ <strong>—Ç–µ–∫—Å—Ç</strong>
        const formatted = ins.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        return `
        <div style='font-size:clamp(12px,3vw,13px);line-height:1.6;margin-bottom:${i < insights.length - 1 ? '16px' : '0'};opacity:0.95;white-space:pre-wrap;'>
          ${formatted}
        </div>
      `}).join('')}
    </div>
  `;

  container.innerHTML = html;
  document.querySelector('.container').appendChild(container);

  console.log('‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫ —Å–æ–∑–¥–∞–Ω');
})();
